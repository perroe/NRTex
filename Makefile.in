#########################################################
# 
# This Makefile is automatically generated by configure
# The source is Makefile.in
#
#########################################################

MAIN  = nrdoc
MANUAL = manual
PRINT  = printmanual
INSTALLPATH = /nr/group/maler/nrdoc

WEBPATH = /nr/www/virtual/files.nr.no/htdocs
VERSION = <<version_number>>
PATCH   = <<patch_number>>
TGZNAME = nrtex-${VERSION}
RPMFLAGS =   --define "_sourcedir $$PWD" \
             --define "_builddir $$PWD/BUILD" \
             --define "_rpmdir $$PWD" \
             --define "_srcrpmdir $$PWD"

RPMPATH = i586

RPMFILE = nrtex-${VERSION}-${PATCH}.i586.rpm

.SUFFIXES: .tex .dvi .pdf

.SILENT: config

all:	manual

config:
	configure



manual: 
	latex '\scrollmode \input '"$(MANUAL)";\
	makeindex $(MANUAL); \
	bibtex $(MANUAL); \
	latex '\scrollmode \input '"$(MANUAL)";\
	while ( \
	grep -s 'No file $(MANUAL).toc' $(MANUAL).log || \
	grep -s 'Rerun to get cross-references right'\
	$(MANUAL).log ); \
	do latex '\scrollmode \input '"$(MANUAL)"; \
	done; \
	dvipdfm -p a4 -o   $(MANUAL).pdf $(MANUAL).dvi


printmanual: 
	perl -e 'open (IFILE,"<manual.tex"); open(OFILE,">printmanual.tex"); while(<IFILE>) { s/\\documentclass\[note,screen,british,11pt\]\{nrdoc\}/\\documentclass\[note,twoside,british,11pt\]\{nrdoc\}/;print OFILE; } close(IFILE); close(OFILE)';
	latex '\scrollmode \input '"$(PRINT)";\
	makeindex $(PRINT); \
	bibtex $(PRINT); \
	latex '\scrollmode \input '"$(PRINT)";\
	while ( \
	grep -s 'No file $(PRINT).toc' $(PRINT).log || \
	grep -s 'Rerun to get cross-references right'\
	$(PRINT).log ); \
	do latex '\scrollmode \input '"$(PRINT)"; \
	done; \
	dvipdfm -p a4 -o   $(PRINT).pdf $(PRINT).dvi


html:	
	latex2html -split 0 -no_navigation -dir manual.web -local_icons manual

install: html manual printmanual rpm
	cp nrdoc.cls $(INSTALLPATH)/	
	cp elements/*.eps $(INSTALLPATH)/elements	
	cp elements/*.pdf $(INSTALLPATH)/elements	
	cp logos/*.eps $(INSTALLPATH)/logos	
	cp logos/*.pdf $(INSTALLPATH)/logos
	cp nrdocold.cls $(INSTALLPATH)/	
	cp nrfoils.cls $(INSTALLPATH)/
	cp background.sty $(INSTALLPATH)/
	cp manual.pdf $(INSTALLPATH)/	
	cp apalike-url-norsk.bst $(INSTALLPATH)/	
	cp apalike-url.bst  $(INSTALLPATH)/		
	cp unsrturl.bst  $(INSTALLPATH)/	
	cp nrdoc.html $(WEBPATH)/latex-maler/index.html
	cp $(MANUAL).pdf $(WEBPATH)/latex-maler/	
	cp $(MANUAL).tex $(WEBPATH)/latex-maler/
	cp -r $(MANUAL).web/*  $(WEBPATH)/latex-maler/$(MANUAL).web/	
	cp $(PRINT).pdf $(WEBPATH)/latex-maler/
	cp $(RPMPATH)/$(RPMFILE) $(WEBPATH)/latex-maler/
	rm -f $(WEBPATH)/latex-maler/nrtex.i586.rpm 
	ln -s $(WEBPATH)/latex-maler/$(RPMFILE) $(WEBPATH)/latex-maler/nrtex.i586.rpm
	chgrp -R www  $(WEBPATH)/latex-maler

clean:
	rm -f  *~ *.aux *.dvi \
	*.log *.pdf *.bbl *.out *.blg *.brf *.ind *.ps *.toc \
	*.idx *.lof *.ilg

tgz:	manual
	mkdir -p ${TGZNAME}
	mkdir -p ${TGZNAME}/elements
	mkdir -p ${TGZNAME}/logos
	cp logos/*.pdf logos/*.eps logos/*.jpg logos/*.png  ${TGZNAME}/logos; \
	cp elements/*.eps elements/*.pdf ${TGZNAME}/elements; \
	cp ${MAIN}.cls ${MAIN}old.cls nrfoils.cls background.sty \
	$(MANUAL).pdf apalike-url.bst apalike-url-norsk.bst \
	unsrturl.bst \
	nrunsrt.bst nrnorsk.bst  nrplain.bst ${TGZNAME}
	tar cvfz ${TGZNAME}.tar.gz ${TGZNAME}

rpm:	tgz 
	-rm -rf BUILD/*
	mkdir -p BUILD
	rpmbuild ${RPMFLAGS} -v -bb --clean  nrtex.spec

